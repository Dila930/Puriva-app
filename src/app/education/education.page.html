<ion-content [fullscreen]="true" class="news-content">
  <div class="container">
    <!-- Header Section -->
    <div class="header fade-in-up">
      <div class="page-title">📰 Berita & Update</div>
      <div class="header-subtitle">Informasi terbaru seputar PURIVA</div>
      
      <!-- Category Filter (synced with create page) -->
      <div class="news-categories">
        <button class="category-btn" 
                [class.active]="currentFilter === 'semua'"
                (click)="filterNews('semua')">Semua</button>
        <button class="category-btn" 
                [class.active]="currentFilter === 'umum'"
                (click)="filterNews('umum')">Umum</button>
        <button class="category-btn" 
                [class.active]="currentFilter === 'teknologi'"
                (click)="filterNews('teknologi')">Teknologi</button>
        <button class="category-btn" 
                [class.active]="currentFilter === 'kesehatan'"
                (click)="filterNews('kesehatan')">Kesehatan</button>
        <button class="category-btn" 
                [class.active]="currentFilter === 'panduan'"
                (click)="filterNews('panduan')">Panduan</button>
      </div>
      
      <!-- Search Bar -->
      <input type="text" 
             class="search-bar" 
             placeholder="🔍 Cari berita..." 
             [(ngModel)]="searchQuery"
             (input)="searchNews($event)">
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
      <!-- Selection mode bar -->
      <div *ngIf="selectionMode" style="position: sticky; top: 0; z-index: 10; background: var(--ion-color-light); padding: 8px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
        <div>{{ selectedIds.size }} dipilih</div>
        <div style="display:flex; gap:8px; align-items:center;">
          <ion-button *ngIf="isAdmin && selectedIds.size > 0" size="small" color="danger" fill="solid" (click)="confirmDeleteSelected()">
            <ion-icon name="trash-outline" slot="start"></ion-icon>
            Hapus ({{ selectedIds.size }})
          </ion-button>
          <ion-button size="small" fill="outline" (click)="exitSelectionMode()">Selesai</ion-button>
        </div>
      </div>
      <!-- Featured News -->
      <div class="featured-news slide-in-card" (click)="openNewsDetail(featuredNews)">
        <div class="featured-image" style="position:relative; overflow:hidden;">
          <img *ngIf="featuredNews?.thumbnail" [src]="featuredNews.thumbnail" alt="thumbnail"
               style="width:100%; height:100%; object-fit:cover; display:block;"/>
          <div *ngIf="!featuredNews?.thumbnail" style="font-size:48px; line-height:1; display:flex; align-items:center; justify-content:center; width:100%; height:100%;">🔬</div>
          <div class="featured-badge">{{ featuredNews.categoryLabel }}</div>
        </div>
        <div class="featured-content">
          <div class="featured-title">{{ featuredNews.title }}</div>
          <div class="featured-excerpt">{{ featuredNews.description }}</div>
          <div class="featured-meta">
            <span>📅 {{ featuredNews.date }}</span>
            <div class="read-more">Baca Selengkapnya</div>
          </div>
        </div>
      </div>
      
      <!-- News List -->
      <div class="news-list">
        <div class="news-item slide-in-card" 
             *ngFor="let news of filteredNews; let i = index" 
             [attr.data-category]="news.category"
             (click)="openNewsDetail(news)"
             [style.animation-delay]="(0.3 + i * 0.1) + 's'"
             [style.position]="'relative'">

          <!-- Selection overlay -->
          <div *ngIf="selectionMode" (click)="toggleSelect($event, news.id)" style="position: absolute; top: 8px; left: 8px; z-index: 5;">
            <ion-icon [name]="selectedIds.has(news.id) ? 'checkmark-circle' : 'ellipse-outline'" [style.font-size.px]="22"></ion-icon>
          </div>
          <!-- Admin more button -->
          <div *ngIf="isAdmin && !selectionMode" (click)="openItemActions($event, news)" style="position: absolute; top: 6px; right: 6px; z-index: 5;">
            <ion-button size="small" fill="clear" color="medium">
              <ion-icon name="ellipsis-vertical"></ion-icon>
            </ion-button>
          </div>
          <div class="news-thumbnail" [ngClass]="news.category" style="position:relative; overflow:hidden;">
            <img *ngIf="news?.thumbnail" [src]="news.thumbnail" alt="thumbnail"
                 style="width:100%; height:100%; object-fit:cover; display:block;"/>
            <div *ngIf="!news?.thumbnail" style="font-size:28px; line-height:1; display:flex; align-items:center; justify-content:center; width:100%; height:100%;">
              {{ news.icon }}
            </div>
            <div class="category-label">{{ news.categoryLabel }}</div>
          </div>
          <div class="news-content">
            <div class="news-title">{{ news.title }}</div>
            <div class="news-excerpt">{{ news.description }}</div>
            <div class="news-meta">
              <div class="news-date">📅 {{ news.date }}</div>
              <div class="read-time">⏱️ {{ news.readTime }} menit baca</div>
            </div>
            <!-- Reactions -->
            <div class="news-reactions" style="display:flex; gap:12px; margin-top:8px;">
              <ion-button fill="clear" size="small" (click)="onNewsReact($event, news.id, 'like')">
                <ion-icon [name]="getMyNewsReaction(news.id) === 'like' ? 'thumbs-up' : 'thumbs-up-outline'" slot="start"></ion-icon>
                {{ getNewsCounts(news.id).likes }}
              </ion-button>
              <ion-button fill="clear" size="small" color="medium" (click)="onNewsReact($event, news.id, 'dislike')">
                <ion-icon [name]="getMyNewsReaction(news.id) === 'dislike' ? 'thumbs-down' : 'thumbs-down-outline'" slot="start"></ion-icon>
                {{ getNewsCounts(news.id).dislikes }}
              </ion-button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Load More Button -->
      <div class="load-more" (click)="loadMoreNews()" *ngIf="showLoadMore">
        📄 {{ loadingMore ? '⏳ Memuat...' : 'Muat Berita Lainnya' }}
      </div>
    </div>
  </div>
</ion-content>

<!-- FAB: Create News (admin only) -->
<ion-fab class="fab-above-bottom-nav" vertical="bottom" horizontal="end" *ngIf="isAdmin">
  <ion-fab-button color="primary" (click)="goToCreateNews()" aria-label="Tambah Berita">
    <ion-icon name="add"></ion-icon>
  </ion-fab-button>
  <ion-fab-list side="top"></ion-fab-list>
  <ion-fab-list side="start"></ion-fab-list>
</ion-fab>

<app-bottom-nav [activeTab]="'news'"></app-bottom-nav>
