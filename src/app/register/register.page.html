<ion-content class="puriva-register-page">
  <div class="puriva-login-container">
    <div class="puriva-login-card">
      <div class="puriva-login-header">
        <div class="puriva-logo-section">
          <div class="puriva-logo">PURIVA</div>
          <div class="puriva-logo-subtitle">Smart UV Chamber untuk Program Makan Gratis</div>
        </div>
        <div class="puriva-welcome-text">Buat Akun Baru</div>
        <div class="puriva-welcome-subtitle">Isi data diri Anda untuk mendaftar</div>
      </div>

      <form #registerForm="ngForm" class="puriva-form-section" novalidate (ngSubmit)="$event.preventDefault()">
        <ion-list lines="none" class="ion-no-margin">
          <!-- Username -->
          <ion-item class="puriva-form-item">
            <ion-label position="stacked">Username</ion-label>
            <ion-input
              type="text"
              placeholder="Pilih username"
              [(ngModel)]="username"
              name="username"
              required
            ></ion-input>
            <ion-icon name="person-outline" slot="start" class="puriva-input-icon"></ion-icon>
          </ion-item>

          <!-- Email -->
          <ion-item class="puriva-form-item">
            <ion-label position="stacked">Email</ion-label>
            <ion-input
              type="email"
              placeholder="user@example.com"
              [(ngModel)]="email"
              name="email"
              required
              email
              [readonly]="isGoogleSignUp"
              [disabled]="isGoogleSignUp"
            ></ion-input>
            <ion-icon name="mail-outline" slot="start" class="puriva-input-icon"></ion-icon>
            <ion-note *ngIf="isGoogleSignUp" slot="end" color="medium" class="ion-padding-start">
              <small>Email dari Google</small>
            </ion-note>
          </ion-item>

          <!-- Hanya Email dan Password diperlukan -->

          <!-- Password -->
          <ion-item class="puriva-form-item" *ngIf="!isGoogleSignUp">
            <ion-label position="stacked">Password</ion-label>
            <ion-input
              [type]="showPassword ? 'text' : 'password'"
              placeholder="Buat password"
              [(ngModel)]="password"
              name="password"
              required
              minlength="6"
              (ionFocus)="onPasswordFocus()"
              (ionBlur)="onPasswordBlur()"
            ></ion-input>
            <ion-icon name="lock-closed-outline" slot="start" class="puriva-input-icon"></ion-icon>
            <ion-button *ngIf="!typingPassword && password" fill="clear" slot="end" (click)="togglePassword()">
              <ion-icon [name]="showPassword ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
            </ion-button>
          </ion-item>
          <p *ngIf="!isGoogleSignUp" class="puriva-field-help">Password ini hanya untuk aplikasi Puriva, bukan password email Anda.</p>
          
          <!-- Google Sign Up Notice -->
          <div *ngIf="isGoogleSignUp" class="ion-padding-vertical">
            <ion-note color="primary">
              <ion-icon name="logo-google" slot="start"></ion-icon>
              Anda mendaftar dengan akun Google. Klik Daftar untuk melanjutkan.
            </ion-note>
          </div>

          <!-- Konfirmasi Password dihapus sesuai permintaan -->

          <!-- Checkbox Persetujuan (wajib baca & setuju lewat modal) -->
          <ion-item lines="none" class="puriva-checkbox-group">
            <ion-checkbox slot="start" [checked]="agreeToTerms" (ionChange)="onTermsAttempt($event)"></ion-checkbox>
            <ion-label class="ion-text-wrap">
              Saya menyetujui
              <a (click)="openPolicy()" class="puriva-register-link">Kebijakan Privasi</a>
              Puriva
            </ion-label>
          </ion-item>

          <!-- Tombol Daftar -->
          <ion-button 
            expand="block" 
            class="puriva-btn-primary" 
            type="button"
            (click)="register()"
            [disabled]="isLoading"
          >
            <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
            <span *ngIf="!isLoading">Daftar</span>
          </ion-button>

          <!-- Link ke Halaman Login -->
          <div class="puriva-register-section">
            Sudah punya akun?
            <a (click)="goToLogin()" class="puriva-register-link">Masuk di sini</a>
          </div>
        </ion-list>
      </form>
      
      <!-- Modal Kebijakan Privasi -->
      <ion-modal [isOpen]="showPolicyModal" (didDismiss)="onPolicyDismiss()" cssClass="puriva-policy-modal">
        <ng-template>
          <ion-header class="policy-header" translucent>
            <ion-toolbar>
              <ion-title>
                <div class="policy-title">
                  <ion-icon name="shield-checkmark-outline"></ion-icon>
                  Kebijakan Privasi
                </div>
                <div class="policy-subtitle">Ringkasan singkat & mudah dipahami</div>
              </ion-title>
              <ion-buttons slot="end">
                <ion-button fill="clear" (click)="declinePolicy()">
                  <ion-icon name="close-outline"></ion-icon>
                </ion-button>
              </ion-buttons>
            </ion-toolbar>
          </ion-header>
          <ion-content class="policy-content ion-padding">
            <div class="policy-card">
              <ul class="policy-list">
                <li>
                  <ion-icon name="person-outline"></ion-icon>
                  Kami menyimpan username dan email Anda hanya untuk autentikasi dan dukungan layanan Puriva.
                </li>
                <li>
                  <ion-icon name="lock-closed-outline"></ion-icon>
                  Data diamankan dan tidak dibagikan ke pihak ketiga, kecuali diwajibkan oleh hukum.
                </li>
                <li>
                  <ion-icon name="time-outline"></ion-icon>
                  Anda dapat mengajukan penghapusan akun & data melalui menu Profil kapan saja.
                </li>
              </ul>
              <ion-note color="medium" class="policy-note">
                Dengan melanjutkan, Anda menyetujui ketentuan di atas dan Syarat Layanan Puriva.
              </ion-note>
            </div>

            <div class="policy-actions">
              <ion-button expand="block" class="policy-accept" (click)="acceptPolicy()">Saya Setuju</ion-button>
              <ion-button expand="block" fill="outline" class="policy-decline" (click)="declinePolicy()">Tidak Setuju</ion-button>
            </div>
          </ion-content>
        </ng-template>
      </ion-modal>
    </div>
  </div>
</ion-content>
