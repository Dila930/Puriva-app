<ion-header translucent="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/profile" icon="chevron-back-outline" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>Statistik</ion-title>
  </ion-toolbar>
  
</ion-header>

<ion-content [fullscreen]="true" class="statistics-dashboard">
  <div class="container">
    <!-- Hero Section with Title and Period Pills -->
    <div class="hero">
      <div class="hero-top">
        <div class="hero-title">📊 Statistik Data</div>
      </div>
      <div class="hero-period">
        <button class="period-pill" [class.active]="selectedPeriod==='daily'" (click)="changePeriod('daily')">Harian</button>
        <button class="period-pill" [class.active]="selectedPeriod==='weekly'" (click)="changePeriod('weekly')">Mingguan</button>
        <button class="period-pill" [class.active]="selectedPeriod==='monthly'" (click)="changePeriod('monthly')">Bulanan</button>
      </div>
    </div>

    <div class="main-content">
      <!-- Stats Overview Section -->
      <div class="stats-overview">
        <div class="section-title">📋 Ringkasan</div>

        <!-- Featured Total Card -->
        <div class="featured-stat">
          <div class="featured-number">{{ statsTotals.total | number:'1.0-0' }}</div>
          <div class="featured-label">Total Disterilisasi</div>
          <div class="featured-subtitle">Periode saat ini</div>
        </div>

        <!-- Summary Grid -->
        <div class="summary-grid">
          <div class="summary-card">
            <div class="card-content">
              <div class="summary-number">{{ statsTotals.berhasil | number:'1.0-0' }}</div>
              <div class="summary-label">Berhasil</div>
              <div class="summary-change change-positive">+0.2 minggu</div>
            </div>
          </div>
          <div class="summary-card">
            <div class="card-content">
              <div class="summary-number">{{ getEffectiveness() | number:'1.0-0' }}%</div>
              <div class="summary-label">Efektivitas</div>
              <div class="summary-change change-positive">+0.5%</div>
            </div>
          </div>
          <div class="summary-card">
            <div class="card-content">
              <div class="summary-number">{{ statsTotals.gagal | number:'1.0-0' }}</div>
              <div class="summary-label">Gagal</div>
              <div class="summary-change change-negative">-8%</div>
            </div>
          </div>
          <div class="summary-card">
            <div class="card-content">
              <div class="summary-number">{{ statsTotals.total | number:'1.0-0' }}</div>
              <div class="summary-label">Total</div>
              <div class="summary-change change-positive">100%</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chart Section -->
      <div class="chart-section">
        <div class="section-title">📊 Trend Aktivitas</div>
        <div class="chart-container">
          <div class="bar" *ngFor="let v of getSortedDetailData(); let i = index" [style.height.%]="getBarHeight(v.value)">
            <div class="bar-value">{{ v.value }}</div>
            <div class="bar-label">{{ v.label }}</div>
          </div>
        </div>
      </div>

      <!-- Food Distribution Section -->
      <div class="food-distribution">
        <div class="section-title">🍽️ Distribusi Makanan</div>
        <div class="pie-container">
          <div class="pie-chart">
            <div class="pie-center">
              <div class="pie-total">{{ statsTotals.total | number:'1.0-0' }}</div>
              <div>Total</div>
            </div>
          </div>
          <div class="legend">
            <div class="legend-item" *ngFor="let f of getSortedDetailData(); let idx = index">
              <div class="legend-color" [style.background]="getLegendColor(idx)"></div>
              <span class="legend-text">{{ f.label }}</span>
              <span class="legend-value">{{ getPercentage(f.value) | number:'1.0-0' }}%</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Food Breakdown Section -->
      <div class="food-breakdown">
        <div class="section-title">📝 Detail</div>
        <div class="food-item" *ngFor="let f of getSortedDetailData()">
          <div class="food-content">
            <div class="food-name">{{ f.label }}</div>
            <div class="food-stats">{{ getPercentage(f.value) }}% dari maksimum</div>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="getPercentage(f.value)"></div>
            </div>
          </div>
          <div class="food-count">{{ f.value | number:'1.0-0' }}</div>
        </div>
      </div>
    </div>
  </div>
</ion-content>